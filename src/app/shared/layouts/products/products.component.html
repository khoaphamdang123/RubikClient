<div class="page-container">
    <!-- Mobile Filter Toggle Button -->
    <button 
      class="mobile-filter-toggle" 
      (click)="toggleMobileFilter()"
      [attr.aria-expanded]="isMobileFilterOpen"
      aria-label="Toggle filters">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
      </svg>
      <span>Filters</span>
      @if(hasActiveFilters) {
        <span class="filter-badge">{{ activeFilterCount }}</span>
      }
    </button>

    <!-- Filter Sidebar -->
    <aside class="filter-container" [class.mobile-open]="isMobileFilterOpen">
      <div class="filter-header">
        <h1 class="filter-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          Filters
        </h1>
        <button class="close-filter-btn" (click)="toggleMobileFilter()" aria-label="Close filters">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Search Box -->
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search products..."
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          aria-label="Search products">
      </div>

      <!-- Category Filters -->
      <div class="filter-section">
        <h2 class="filter-section-title">Categories</h2>
        <div class="filter-options">
          @for(option of filter_options; track $index) {
            <label class="filter-checkbox-label">
              <input 
                type="checkbox" 
                [checked]="option.checked" 
                (change)="toggleCheckBox(option)"
                [attr.aria-label]="option.name">
              <span class="checkbox-custom"></span>
              <span class="filter-label-text">{{option.name}}</span>
            </label>
          }
        </div>
      </div>

      <div class="filter-divider"></div>

      <!-- Clear Filters -->
      @if(hasActiveFilters) {
        <button class="clear-all-btn" (click)="clearAllCheckBox()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
          Clear All Filters
        </button>
      }
    </aside>

    <!-- Overlay for mobile -->
    @if(isMobileFilterOpen) {
      <div class="filter-overlay" (click)="toggleMobileFilter()"></div>
    }

    <!-- Main Content -->
    <main class="product-container">
      <!-- Toolbar -->
      <div class="products-toolbar">
        <div class="toolbar-left">
          <h2 class="products-title">Our Products</h2>
          <p class="products-count">
            @if(isLoading) {
              <span>Loading...</span>
            } @else {
              <span>{{ resultCount }} {{ resultCount === 1 ? 'product' : 'products' }}</span>
            }
          </p>
        </div>
        
        <div class="toolbar-right">
          <label class="sort-label" for="sort-select">Sort by:</label>
          <select 
            id="sort-select"
            class="sort-select" 
            [(ngModel)]="sortOption" 
            (change)="onSortChange()"
            aria-label="Sort products">
            @for(option of sortOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Loading State / Empty State / Products Grid -->
      @if(isLoading) {
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p class="loading-text">Loading amazing products...</p>
        </div>
      } @else if(displayedRubikList.length === 0) {
        <div class="empty-state">
          <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <h3 class="empty-title">No products found</h3>
          <p class="empty-description">
            @if(hasActiveFilters) {
              Try adjusting your filters or search query
            } @else {
              No products available at the moment
            }
          </p>
          @if(hasActiveFilters) {
            <button class="empty-action-btn" (click)="clearAllCheckBox(); searchQuery = ''; onSearchChange()">
              Clear all filters
            </button>
          }
        </div>
      } @else {
        <div class="product-grid">
          @for(item of displayedRubikList; track item.id || $index) {
            <div class="product-card-wrapper">
              <app-items [rubik]="item"></app-items>
            </div>
          }
        </div>
      }
    </main>
  </div>