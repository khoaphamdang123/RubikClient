<!-- Loading State -->
@if(isLoading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading product details...</p>
  </div>
} @else {
  <div class="product-detail-page">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <ol>
        <li>
          <a routerLink="/" class="breadcrumb-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Home
          </a>
        </li>
        <li>
          <svg class="breadcrumb-separator" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </li>
        <li>
          <a routerLink="/products" class="breadcrumb-link">Products</a>
        </li>
        <li>
          <svg class="breadcrumb-separator" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </li>
        <li class="breadcrumb-current" aria-current="page">{{ rubik.name }}</li>
      </ol>
    </nav>

    <!-- Product Content -->
    <div class="product-content">
      <!-- Image Gallery Section -->
      <div class="gallery-section">
        <!-- Main Image Display -->
        <div class="main-image-container">
          <img 
            [src]="selectedImage" 
            [alt]="rubik.name"
            class="main-image"
            loading="lazy"
            (click)="openZoom()"
            title="Click to zoom">
          
          <!-- Zoom Icon Indicator -->
          <div class="zoom-indicator">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              <line x1="11" y1="8" x2="11" y2="14"></line>
              <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
          </div>
          
          <!-- Image Navigation Arrows -->
          <button 
            class="image-nav-btn prev-btn" 
            (click)="previousImage()"
            [disabled]="!canGoPrevious"
            [class.disabled]="!canGoPrevious"
            aria-label="Previous image">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          
          <button 
            class="image-nav-btn next-btn" 
            (click)="nextImage()"
            [disabled]="!canGoNext"
            [class.disabled]="!canGoNext"
            aria-label="Next image">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>

          <!-- Image Counter -->
          <div class="image-counter">
            {{ currentImageIndex + 1 }} / {{ detailImages.length }}
          </div>
        </div>

        <!-- Thumbnail Gallery -->
        <div class="thumbnail-gallery">
          @for(image of detailImages; track $index) {
            <button
              class="thumbnail-btn"
              [class.active]="selectedImage === image"
              (click)="selectImage(image, $index)"
              [attr.aria-label]="'View image ' + ($index + 1)">
              <img 
                [src]="image" 
                [alt]="rubik.name + ' - Image ' + ($index + 1)"
                class="thumbnail-image"
                loading="lazy">
            </button>
          }
        </div>
      </div>

      <!-- Product Information Section -->
      <div class="info-section">
        <!-- Product Header -->
        <div class="product-header">
          <h1 class="product-title">{{ rubik.name }}</h1>
          
          <!-- Product Badge -->
          <span class="product-badge">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </svg>
            Premium Quality
          </span>
        </div>

        <!-- Product Features -->
        @if(rubik.features) {
          <div class="product-features">
            <h3 class="features-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Key Features
            </h3>
            <p class="features-text">{{ rubik.features }}</p>
          </div>
        }

        <!-- Product Description -->
        <div class="product-description">
          <h3 class="description-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Description
          </h3>
          
          <div class="description-content">
            <p [innerHTML]="getDescription()"></p>
            
            @if(description.split(' ').length > 50) {
              <button 
                class="read-more-btn" 
                (click)="toggleDescription()"
                [attr.aria-expanded]="showFullDescription">
                {{ showFullDescription ? 'Read Less' : 'Read More' }}
                <svg 
                  class="read-more-icon" 
                  [class.rotated]="showFullDescription"
                  xmlns="http://www.w3.org/2000/svg" 
                  width="16" 
                  height="16" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
            }
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-outline" routerLink="/products">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Products
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Zoom Modal -->
  @if(isZoomed) {
    <div class="zoom-modal" (click)="closeZoom()">
      <div class="zoom-modal-content" (click)="$event.stopPropagation()">
        <!-- Close Button -->
        <button class="zoom-close-btn" (click)="closeZoom()" aria-label="Close zoom">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <!-- Zoomed Image -->
        <img 
          [src]="selectedImage" 
          [alt]="rubik.name"
          class="zoomed-image">

        <!-- Navigation Arrows -->
        @if(canGoPrevious) {
          <button 
            class="zoom-nav-btn zoom-prev-btn" 
            (click)="previousImageZoom()"
            aria-label="Previous image">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
        }

        @if(canGoNext) {
          <button 
            class="zoom-nav-btn zoom-next-btn" 
            (click)="nextImageZoom()"
            aria-label="Next image">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        }

        <!-- Image Counter -->
        <div class="zoom-counter">
          {{ currentImageIndex + 1 }} / {{ detailImages.length }}
        </div>

        <!-- Instructions -->
        <div class="zoom-instructions">
          Click outside image to close â€¢ Use arrows to navigate
        </div>
      </div>
    </div>
  }
}
